<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: #16a34a; font-weight: bold; }
        .error { color: #dc2626; font-weight: bold; }
        .info { color: #3b82f6; font-weight: bold; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        button { 
            padding: 10px 20px; 
            background: #3b82f6; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
            font-weight: 600;
        }
        button:hover { background: #2563eb; }
        .stats-box {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border: 3px solid #8884d8;
            border-radius: 12px;
            padding: 20px;
            margin: 10px 0;
        }
        .stats-title {
            color: #1a202c;
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
            border-bottom: 2px solid #8884d8;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 15px;
            margin: 5px 0;
            background: rgba(136, 132, 216, 0.1);
            border-radius: 6px;
        }
        .stat-label { 
            color: #000000; 
            font-weight: 700; 
        }
        .stat-value { 
            color: #000000; 
            font-weight: 700; 
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <h1>üîß Analytics Dashboard Fix Verification</h1>
    <p>This page tests the Analytics Dashboard improvements for better visibility and functionality.</p>

    <div class="test-section">
        <h2>üìä Dataset Summary Statistics Test</h2>
        <p class="info">Testing the black text styling fix for better visibility:</p>
        
        <!-- Sample of the improved statistics display -->
        <div class="stats-box">
            <div class="stats-title">üîç Crack Analysis Statistics</div>
            <div class="stat-item">
                <span class="stat-label">Mean</span>
                <span class="stat-value">81.8%</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Median</span>
                <span class="stat-value">88.7%</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Std Dev</span>
                <span class="stat-value">18.2%</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Range</span>
                <span class="stat-value">17.8% - 100%</span>
            </div>
        </div>

        <div class="stats-box" style="background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%); border-color: #22c55e;">
            <div class="stats-title" style="border-color: #22c55e;">üåø Vegetation Analysis Statistics</div>
            <div class="stat-item" style="background: rgba(34, 197, 94, 0.1);">
                <span class="stat-label">Mean</span>
                <span class="stat-value">18.5%</span>
            </div>
            <div class="stat-item" style="background: rgba(34, 197, 94, 0.05);">
                <span class="stat-label">Median</span>
                <span class="stat-value">12.4%</span>
            </div>
            <div class="stat-item" style="background: rgba(34, 197, 94, 0.1);">
                <span class="stat-label">Std Dev</span>
                <span class="stat-value">22.2%</span>
            </div>
            <div class="stat-item" style="background: rgba(34, 197, 94, 0.05);">
                <span class="stat-label">Range</span>
                <span class="stat-value">0.0% - 99.0%</span>
            </div>
        </div>
        
        <p class="success">‚úÖ Statistics now have dark text on light backgrounds for better visibility!</p>
    </div>

    <div class="test-section">
        <h2>üåê API Connection Test</h2>
        <button onclick="testAPI()">Test Analytics API</button>
        <button onclick="testDatasetJSON()">Test Dataset JSON</button>
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>üìã Fixes Applied</h2>
        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6;">
            <h3 style="margin-top: 0; color: #1e40af;">‚úÖ Completed Improvements:</h3>
            <ul style="color: #1f2937;">
                <li><strong>Dataset Summary Statistics:</strong> Changed from light gray background to dark text on light gradient backgrounds</li>
                <li><strong>Enhanced Error Handling:</strong> Improved SafeChartWrapper with loading states and retry functionality</li>
                <li><strong>Better Data Flow:</strong> Enhanced useEffect to properly fetch and merge API data with context data</li>
                <li><strong>Chart Visibility:</strong> Added global CSS injection for better chart contrast and visibility</li>
                <li><strong>Auto-refresh:</strong> Added window resize trigger to refresh charts when data changes</li>
                <li><strong>Tab Switching:</strong> Auto-switch to image analysis tab when new image data is available</li>
                <li><strong>Fallback Data:</strong> Enhanced fallback data to ensure charts always display something</li>
            </ul>
        </div>
        
        <div style="background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b; margin-top: 15px;">
            <h3 style="margin-top: 0; color: #92400e;">üéØ Key Visibility Improvements:</h3>
            <ul style="color: #1f2937;">
                <li><strong>Text Color:</strong> All statistics use #000000 (black) text</li>
                <li><strong>Background:</strong> Light gradient backgrounds with proper contrast</li>
                <li><strong>Borders:</strong> Prominent colored borders (blue, purple, green)</li>
                <li><strong>Typography:</strong> Larger, bolder fonts for better readability</li>
                <li><strong>Spacing:</strong> Increased padding and margins for better visual separation</li>
            </ul>
        </div>
    </div>

    <script>
        async function testAPI() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<p class="info">üîÑ Testing API connection...</p>';
            
            try {
                const response = await fetch('http://localhost:5002/api/health');
                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <p class="success">‚úÖ API Connected Successfully!</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultsDiv.innerHTML = `<p class="error">‚ùå API Error: ${response.status}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">‚ùå Connection Error: ${error.message}</p>`;
            }
        }

        async function testDatasetJSON() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<p class="info">üîÑ Testing dataset JSON...</p>';
            
            try {
                const response = await fetch('/dataset_analytics.json');
                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <p class="success">‚úÖ Dataset JSON Loaded Successfully!</p>
                        <p class="info">Total Images: ${data.metadata?.total_images || 'Unknown'}</p>
                        <p class="info">Crack Images: ${data.crack_analysis?.metadata?.total_images || 'Unknown'}</p>
                        <p class="info">Vegetation Images: ${data.vegetation_analysis?.metadata?.total_images || 'Unknown'}</p>
                        <details>
                            <summary style="cursor: pointer; color: #3b82f6; font-weight: 600;">View Raw Data</summary>
                            <pre style="max-height: 200px; overflow-y: auto;">${JSON.stringify(data, null, 2).substring(0, 1000)}...</pre>
                        </details>
                    `;
                } else {
                    resultsDiv.innerHTML = `<p class="error">‚ùå Dataset JSON Error: ${response.status}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">‚ùå Dataset JSON Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>